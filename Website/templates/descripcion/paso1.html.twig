{% extends 'base.html.twig' %}

{% block title %}Asistente - Aragon Open Data{% endblock title %}

{% block stylesheets %}
    {{ parent() }}

     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput-typeahead.css">  

     <link href="{{ asset('theme/bootstrap-tagsinput.css') }}" type="text/css" rel="stylesheet" />
{% endblock %}

{% block body %}
<div class="container" style="display:{{ permisoEdicion }}">
	<div class="row">                  
        <div id="col02" class="col col-12">
             <div class="form formtheme01">
                <h1>Asistente de creación de conjunto de datos</h1>
                <div class="listadoPasos">
                    <ul>
                        <li class="paso01 active">
                            <span>1</span>
                        </li>
                        <li class="paso01-1 uncomplete">
                            <span></span>
                        </li>
                        <li class="paso01-2 uncomplete">
                            <span></span>
                        </li>
                        <li class="paso02 uncomplete">
                            <span>2</span>
                        </li>
                        <li class="paso03 uncomplete">
                            <span>3</span>
                        </li>
                    </ul>
                </div>
                <div>
                  <div class="box">
                    {{ form_start(paso1_form) }}
                    <div class="fieldset fieldset01">
                        <fieldset class="mediumLabels">
                            <legend>Paso 1</legend>
                            <h2>Descripción del conjunto de datos - contenido de los datos</h2>
                            <div>
                                {{ form_widget(paso1_form) }}
                                <div class="fieldset actionButtons">
                                    <fieldset>
                                        <input class="submit principal" type="submit" value="Guardar y siguiente...">
                                    </fieldset>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                   {{ form_end(paso1_form) }}
                </div>
            </div>
        </div>
	</div>
</div>
{% endblock %}



{% block javascripts %}
   {{ parent() }}
       <!-- AUTOCOMPLETE -->
    <script type="text/javascript" src="/theme/libraries/jquery.autocomplete.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tagsinput/0.8.0/bootstrap-tagsinput.min.js" charset="UTF-8"></script>
    <script type="text/javascript" src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>-
    <script type='text/javascript' src='/js/datepicker-es.js'></script>
    <script>
        $(document).ready(function() {
            if ($(".container").attr("style") == "display:none") {
                $("#accesoDenegado").modal("show");
                $("#botonCerrraAccesoDenegado").bind("click", function() { 
                       window.location.href = "/asistentecamposdatos";
                });
            } else {
                $('.datepicker').datepicker({
                    isRTL: false,
                    dateFormat:'yy-mm-dd',
                    autoclose:true,
                });
                 var territorio =   $('input[type=hidden][id=territorio').val();
                if (territorio!=null) {
                    var pastesTerritorio = territorio.split(":");
                    var descricion = "";
                    var tipo = "";
                    if (pastesTerritorio.length>0) {
                        tipo = pastesTerritorio[0];
                    }
                    if (pastesTerritorio.length>1) {
                        descricion = pastesTerritorio[1];
                    }
                    
                    if (tipo == "CO") {
                        $('input[type=radio][id=territorios_aragon]').prop('checked', true);
                        CONTROL.cambio(true,false,false,false,false,true);
                    } else if (tipo == "PR") {
                        $('input[type=radio][id=territorios_provincia]').prop('checked', true);
                        $('input[type=text][id=territorios_provincias]').val(descricion);
                        CONTROL.cambio(false,true,false,false,false,true);
                    } else if (tipo == "CM") {
                        $('input[type=radio][id=territorios_comarca]').prop('checked', true);
                        $('input[type=text][id=territorios_comarcas').val(descricion);
                        CONTROL.cambio(false,false,true,false,false,true);
                    } else if (tipo == "LO") {
                        $('input[type=radio][id=territorios_localidad]').prop('checked', true);
                        $('input[type=text][id=territorios_localidades').val(descricion);
                        CONTROL.cambio(false,false,false,true,false,true);
                    } else if (tipo == "OT") {
                        $('input[type=radio][id=territorios_otro]').prop('checked', true); 
                        $('input[type=text][id=territorios_otros').val(descricion);  
                        CONTROL.cambio(false,false,false,false,true,true);
                    }
                }   
            }                     
        });
        $(function() {
           $.getJSON( "/resources/provincias.json", function( availableProvincias ) {
              $(".povinciasAutoComplete").autocomplete({
                 source: availableProvincias
               });
            });
        });
        $(function() {
            $.getJSON( "/resources/comarcas.json", function( availableComarcas ) {
              $(".comarcasAutoComplete").autocomplete({
                 source: availableComarcas
               });
            });
        });
        $(function() {
            $.getJSON( "/resources/localidades.json", function( availableLocalidades ) {
              $(".localidadesAutoComplete").autocomplete({
                 source: availableLocalidades
               });
            });
        });


        CONTROL = {
           cambio: function(aragon, provincias, comarcas, localidades, otros, territorio) {
                if (aragon) {
                    $('input[type=radio][id=territorios_provincia]').prop('checked', false);
                    $('input[type=radio][id=territorios_comarca]').prop('checked', false);
                    $('input[type=radio][id=territorios_localidad]').prop('checked', false);
                    $('input[type=radio][id=territorios_otro]').prop('checked', false);

                    $('input[type=text][id=territorios_provincias]').val('');
                    $('input[type=text][id=territorios_comarcas').val('');
                    $('input[type=text][id=territorios_localidades').val('');
                    $('input[type=text][id=territorios_otros').val('');

                } else if (provincias) {
                    $('input[type=radio][id=territorios_aragon]').prop('checked', false);
                    $('input[type=radio][id=territorios_comarca]').prop('checked', false);
                    $('input[type=radio][id=territorios_localidad]').prop('checked', false);
                    $('input[type=radio][id=territorios_otro]').prop('checked', false);

                    $('input[type=text][id=territorios_comarcas').val('');
                    $('input[type=text][id=territorios_localidades').val('');
                    $('input[type=text][id=territorios_otros').val('');

                } else if (comarcas) {

                    $('input[type=radio][id=territorios_aragon]').prop('checked', false);
                    $('input[type=radio][id=territorios_provincia]').prop('checked', false);
                    $('input[type=radio][id=territorios_localidad]').prop('checked', false);
                    $('input[type=radio][id=territorios_otro]').prop('checked', false);

                    $('input[type=text][id=territorios_provincias]').val('');
                    $('input[type=text][id=territorios_localidades').val('');
                    $('input[type=text][id=territorios_otros').val('');

                } else if (localidades) {
                    $('input[type=radio][id=territorios_aragon]').prop('checked', false);
                    $('input[type=radio][id=territorios_provincia]').prop('checked', false);
                    $('input[type=radio][id=territorios_comarca]').prop('checked', false);
                    $('input[type=radio][id=territorios_otro]').prop('checked', false);

                    $('input[type=text][id=territorios_provincias]').val('');
                    $('input[type=text][id=territorios_comarcas').val('');
                    $('input[type=text][id=territorios_otros').val('');
                } else {

                    $('input[type=radio][id=territorios_aragon]').prop('checked', false);
                    $('input[type=radio][id=territorios_provincia]').prop('checked', false);
                    $('input[type=radio][id=territorios_comarca]').prop('checked', false);
                    $('input[type=radio][id=territorios_localidad]').prop('checked', false); 

                    $('input[type=text][id=territorios_provincias]').val('');
                    $('input[type=text][id=territorios_comarcas').val('');
                    $('input[type=text][id=territorios_localidades').val('');
                }
                if (!territorio) { 
                   $('input[type=hidden][id=territorio').val('');
                }
            }
        } 

        $('input[type=radio][id=territorios_aragon]').change(function() {
             CONTROL.cambio(true,false,false,false,false,false);
             $('input[type=hidden][id=territorio').val('CO:Aragón');
        }); 

        $('input[type=radio][id=territorios_provincia]').change(function() {
            CONTROL.cambio(false,true,false,false,false,false);
        }); 

        $('input[type=radio][id=territorios_comarca]').change(function() {
            CONTROL.cambio(false,false,true,false,false,false);
        }); 

        $('input[type=radio][id=territorios_localidad]').change(function() {
            CONTROL.cambio(false,false,false,true,false,false);
        }); 

        $('input[type=radio][id=territorios_otro]').change(function() {
             CONTROL.cambio(false,false,false,false,true,false);
        });
        
        $('input[type=text][id=territorios_provincias]').focus(function() {
            CONTROL.cambio(false,true,false,false,false,false);
            $('input[type=radio][id=territorios_provincia]').prop('checked', true);
        }); 

        $('input[type=text][id=territorios_comarcas]').focus(function() {
            CONTROL.cambio(false,false,true,false,false,false);
            $('input[type=radio][id=territorios_comarca]').prop('checked', true);
        }); 

        $('input[type=text][id=territorios_localidades]').focus(function() {
            CONTROL.cambio(false,false,false,true,false,false);
            $('input[type=radio][id=territorios_localidad]').prop('checked', true);
        }); 

        $('input[type=text][id=territorios_otros]').focus(function() {
             CONTROL.cambio(false,false,false,false,true,false);
             $('input[type=radio][id=territorios_otro]').prop('checked', true);
        });


        $('input[type=text][id=territorios_provincias]').change(function() {
            var territorio = "PR:" + $('input[type=text][id=territorios_provincias]').val();
            $('input[type=hidden][id=territorio').val(territorio );
        }); 

        $('input[type=text][id=territorios_comarcas]').change(function() {
            var territorio = "CM:" + $('input[type=text][id=territorios_comarcas]').val();
            $('input[type=hidden][id=territorio').val(territorio) ;
        }); 

        $('input[type=text][id=territorios_localidades]').change(function() {
            var territorio = "LO:" + $('input[type=text][id=territorios_localidades]').val();
            $('input[type=hidden][id=territorio').val(territorio);
        }); 

        $('input[type=text][id=territorios_otros]').change(function() {
             var territorio = "OT:" + $('input[type=text][id=territorios_otros]').val();
            $('input[type=hidden][id=territorio').val(territorio);
        });

    </script>
{% endblock %}

